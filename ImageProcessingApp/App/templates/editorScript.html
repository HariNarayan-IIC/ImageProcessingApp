<script>
    function updateRangeValue(rangeInput) {
        var spanId = rangeInput.id + '_value';
        $('#' + spanId).text(rangeInput.value);
    }
    $(document).ready(function(){
        $('#Category').change(function() {
            var categoryId = $(this).val();
            $.ajax({
                url: '{% url "ajax_load_operations" %}',
                data: {
                    'category_id': categoryId
                },
                success: function(data) {
                    $('#Operation').html('<option value="">Select Operation</option>');
                    data.forEach(function(operation) {
                        $('#Operation').append('<option value="' + operation.id + '">' + operation.name + '</option>');
                    });
                }
            });
        });
    
        
        $('#Operation').change(function() {
            var operationId = $(this).val();
            var type = "apply";
            $.ajax({
                url: '{% url "ajax_load_parameters" %}',
                data: {
                    'operation_id': operationId,
                    'type': type
                },
                success: function(data) {
                    $('#parameters').empty();
                    data.forEach(function(parameter) {
                        if (parameter.inputType=='range'){
                            $('#parameters').append('<label for="'+ parameter.id +'" class="form-label">'+ parameter.name +' :</label>');
                            $('#parameters').append('<input type="range" class="form-range" min="'+parameter.minValue+'" max="'+parameter.maxValue+'" id="'+ parameter.id + '" name="' + parameter.name +'" oninput="updateRangeValue(this)">');
                            $('#parameters').append('<span id="'+ parameter.id +'_value">'+ parameter.minValue +'</span><br>');
                        }
                        else if (parameter.inputType=='select'){
                            
                            $.ajax({
                                url: '{% url "ajax_load_options" %}',
                                data: {
                                    'parameter_id': parameter.id
                                    
                                },
                                success: function(data) {
                                    var selectHtml = '<select class="form-select" aria-label="Default select example" name="' + parameter.name +'"><br>';
                                    data.forEach(function(option) {
                                        selectHtml += '<option>'+ option.value +'</option>';
                                    });
                                    selectHtml += '</select>';
                                    $('#parameters').append(selectHtml);
                                }
                            });
                        }    
                        else {
                            $('#parameters').append('<label for="' + parameter.id + '">' + parameter.name +':</label><br>');
                            $('#parameters').append('<input type="' + parameter.inputType + 'class = "form-control"' + '" id="' + parameter.id + '" name="' + parameter.name + '"><br>');
                        }
                    });
                }
            });
        });
        
    
        // Handle click event on pencil icon
        $('.update').click(function() {
            $('#updateModal').modal('show');
            event.preventDefault()
            var historyId = $(this).data('history');
            console.log(historyId);
            var type= "update";
            $.ajax({
                url: '{% url "ajax_load_parameters" %}',
                data: {
                    'history_id': historyId,
                    'type': type
                },
                success: function(data) {
                    $('#updateForm').empty();
                    $('#updateForm').append('<input type= "hidden" name="history_id" value="'+ historyId +'">');
                    data.forEach(function(parameter) {
                        if (parameter.inputType=='range'){
                            $('#updateForm').append('<label for="'+ parameter.id +'" class="form-label">'+ parameter.name +' :</label>');
                            $('#updateForm').append('<input type="range" class="form-range" min="'+parameter.minValue+'" max="'+parameter.maxValue+'" id="'+ parameter.id + '" name="' + parameter.name +'" oninput="updateRangeValue(this)">');
                            $('#updateForm').append('<span id="'+ parameter.id +'_value">'+ parameter.minValue +'</span><br>');
                        }
                        else if (parameter.inputType=='select'){
                            
                            $.ajax({
                                url: '{% url "ajax_load_options" %}',
                                data: {
                                    'parameter_id': parameter.id,
                                    
                                },
                                success: function(data) {
                                    var selectHtml = '<select class="form-select" aria-label="Default select example" name="' + parameter.name +'"><br>';
                                    data.forEach(function(option) {
                                        selectHtml += '<option>'+ option.value +'</option>';
                                    });
                                    selectHtml += '</select>';
                                    $('#updateForm').append(selectHtml);
                                }
                            });
                        }    
                        else {
                            $('#updateForm').append('<label for="' + parameter.id + '">' + parameter.name +':</label><br>');
                            $('#updateForm').append('<input type="' + parameter.inputType + 'class = "form-control"' + '" id="' + parameter.id + '" name="' + parameter.name + '"><br>');
                        }
                    });
                }
            });
        }); 
    
        //const myModal = document.getElementById('myModal')
    
        //myModal.addEventListener('shown.bs.modal', () => {
        //    myInput.focus();
        //});

        $('#updateButton').click(function() {
            $('#updateForm').submit();
        });
    
    });
</script>